<!doctype html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Language" content="en">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>amount</title>
<meta name="viewport"
	content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, shrink-to-fit=no" />
<meta name="description"
	content="Choose between regular React Bootstrap tables or advanced dynamic ones.">

<!-- Disable tap highlight on IE -->
<meta name="msapplication-tap-highlight" content="no">

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<script
	src="architectui-html-pro-theme-package/architectui-html-pro-theme/architectui-html-pro/assets/scripts/main.8d288f825d8dffbbe55e.js"></script>
<link
	href="architectui-html-pro-theme-package/architectui-html-pro-theme/architectui-html-pro/main.8d288f825d8dffbbe55e.css"
	rel="stylesheet">
<!-- firebase -->
	<script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-auth.js"></script>
  <!-- TODO: Add SDKs for Firebase products that you want to use
       https://firebase.google.com/docs/web/setup#config-web-app -->
  <!-- firebaseUI -->
  <script src="https://cdn.firebase.com/libs/firebaseui/4.0.0/firebaseui.js"></script>
  <!-- firebase -->
  <script src="https://www.gstatic.com/firebasejs/6.4.0/firebase-database.js"></script>
  <!-- firebase Config and initialize -->	
  <script src="firebase/firebase-config.js"></script>
  
<script th:inline="javascript">

$(function(){
	
	//input text입력시 이벤트발생
	/* $("#rmorder_amount").on("propertychange change keyup paste input", function() {
	    var currentVal = $(this).val();
	    if(currentVal == '') {
	        return;
	    }
	 
	    alert("changed!");
	}); */
	
	/*<![CDATA[*/
    var list = /*[[${pmList}]]*/;
    /*]]>*/
	var database = firebase.database();
	
	selelctInventoryINWarehouse();
	
	function selelctInventoryINWarehouse(){
		database.ref('warehouse/').on('child_added', function(data){
			var warehouse_code = data.key;
			var warehouse_name = data.val().warehouse_name;
			database.ref('warehouse/'+warehouse_code).child("inventory").on('child_added', function(snapshot){
				for(var i in list){
					if(snapshot.key==list[i].rawm_code){
						var rawm_code = snapshot.key;	
						getMaterialAmount(rawm_code, warehouse_name, warehouse_code);
					}
				}	
	    	});
		});
		//파이어베이스로 실시간 원자재 재고 가져오는 함수 
		function getMaterialAmount(rawm_code, warehouse_name, warehouse_code){
			database.ref('warehouse/'+warehouse_code).child("inventory").child(rawm_code).once('value').then(function(snapshot){
				var name = snapshot.key;
				var amount = snapshot.val().systemamount;
				
			});
		}
	}
});

</script>
</head>
<body>

		<div class="col-md-3">
			
				<div class="form-group">
					<label for="rawm_code">원자재명</label> <input id="rawm_code"
						name="rawm_code" list="test" class="form-control" autocomplete="off">
					<datalist class="select" id="test">
						<option class="rList" th:each="list : ${rList}"
							th:text="${list.rawm_name}" th:value="${list.rawm_code}">
						</option>
					</datalist>
				</div>
			
			<div class="form-group">
				<label for="rmorder_amount">원자재수량</label> <input id="rmorder_amount"
					name="rmorder_amount" type="number" class="form-control" autocomplete="off">
			</div>
			
			<div class="form-group">
				<label for="warehouse_code">창고</label> <input id="warehouse_code"
					name="warehouse_code" type="text" class="form-control" autocomplete="off">
			</div>
			
			<div class="form-group">
				<button type="button" class="mb-2 mr-2 btn-square btn btn-primary">요청</button>
			</div>
		</div>

</body>
</html>