<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.erp.dao.ProductionMapper">
	<insert id="productionInsert" parameterType="com.project.erp.vo.ProductVO">
	insert into PRODUCT
	(
		pd_code,
		pd_name,
		pd_rmcost,
		pd_manufcost,
		pd_sort
	)
	values
	(
		'p' || TO_CHAR(pd_code.nextval),
		#{pd_name},
		#{pd_rmcost},
		#{pd_manufcost},
		#{pd_sort}
	)
	</insert>
	<select id="produceSelect" resultType="com.project.erp.vo.ManufactureVO" parameterType="com.project.erp.vo.ManufactureVO">
		SELECT
	 		mfseq
			,pd_code 
 			,TO_CHAR(manuf_startdate, 'YYYY-MM-DD') AS manuf_startdate 
 			,TO_CHAR(manuf_enddate, 'YYYY-MM-DD') AS manuf_enddate
			,manuf_status 
			,warehouse_code 
		 	,manuf_amount
			,sales_ordernum 
			,manuf_requserid 
			,manuf_reqdate 
			,'A' as salesdetailseq 
	 	FROM
		manufacture
<!--	WHERE
 		pd_code=#{pd_code}
 -->	</select>	
 	<select id="productionSelect" resultType="com.project.erp.vo.ProductVO" parameterType="com.project.erp.vo.ProductVO">

		SELECT
	 		pd_code
			,pd_name
 			,pd_rmcost
 			,pd_manufcost
			,pd_sort
			,warehouse_code
	 	FROM
		product
<!--	WHERE
 		pd_code=#{pd_code}
 -->	</select>	
 	<delete id="productionDelete" parameterType="com.project.erp.vo.ProductVO">
		delete
		from
			product
		where
			pd_code=#{pd_code}
	</delete>
	
	<select id="selectLatestProduct" resultType="com.project.erp.vo.ProductVO">
		SELECT
	 		pd_code
			,pd_name
 			,pd_rmcost
 			,pd_manufcost
			,pd_sort
	 	FROM product
	 	WHERE pd_code=(SELECT MAX(pd_code)
	 				   FROM product 
	 					)
	</select>
	
	<insert id="insertProudctMaterial" parameterType="com.project.erp.vo.ProductMaterialVO">
		INSERT INTO product_material
		(
			product_material_code
			, pd_code
			, rawm_code
			, product_material_amount
		)
		VALUES
		(
			 'pm' || TO_CHAR(product_material_code.NEXTVAL)
			, #{pd_code}
			, #{rawm_code}
			, #{product_material_amount}
		)
	</insert>
</mapper>
